#!/bin/bash

echo "ğŸ“¦ Scaling Django deployment to 3 replicas..."
kubectl scale deployment django-messaging-app --replicas=3

echo "â³ Waiting for pods to be ready..."
sleep 10

echo "ğŸ” Checking running pods..."
kubectl get pods

echo "ğŸŒ Port-forwarding service to localhost:8000..."
kubectl port-forward svc/django-messaging-service 8000:8000 &
PORT_PID=$!
sleep 5

echo "ğŸš€ Running load test using wrk..."
wrk -t2 -c50 -d10s http://localhost:8000/

echo "ğŸ“Š Checking resource usage..."
kubectl top pods

echo "ğŸ§¹ Cleaning up port-forward process..."
kill $PORT_PID
